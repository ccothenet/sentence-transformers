import os
from sentence_transformers import SentenceTransformer
import scipy

if __name__ == "__main__":
    list_files = os.listdir()
    list_files = [o for o in list_files if o.startswith("training_nli")]
    list_files = sorted(list_files)
    model_file = list_files[-1]

    text = """
    À défaut de neige, c'est une avalanche de critiques qui a déferlé sur la station de Luchon-Superbagnères (Haute-Garonne) depuis le 14 février. Après avoir décidé d'amener de la neige par hélicoptère en bas de ses pistes qui en manquaient cruellement, la petite station des Pyrénées s'est retrouvée malgré elle au centre d'une polémique remontée jusqu'à la ministre de l'Écologie. « Enneiger les stations de ski par hélicoptère n'est pas une voie possible », a tonné Élisabeth Borne sur Twitter.  Un peu sonnée, la station assume. « Cette action a été réfléchie », assure à France Info son directeur, Christian Mathias, pointant un « hiver particulier et difficile ». Même son de cloche du côté du département, qui gère la station en régie : « Nous avons voulu sauver de l'emploi, je le revendique », lâche Georges Méric, président du conseil départemental de Haute-Garonne, à France Bleu. « Et si vous parlez du bilan carbone de la station, cette année il sera meilleur qu'en 2019 puisque nos dameuses ne travaillent pas. »   closevolume_off  En faisant déplacer de la neige par hélicopère les 14 et 15 février dernier, Luchon-Superbagnères, dans les Pyrénées, a créé une polémique remontée jusqu'au gouvernement.  © ANNE-CHRISTINE POUJOULAT / AFP Raréfaction de la neige Aux côtés de Luchon, les stations concurrentes font bloc et dénoncent une polémique « inutile ». « C'est tellement facile de nous montrer du doigt », lâche Jean-Pierre Rougeaux, maire de Valloire (Savoie), joint par Le Point. « Nous sommes un peu le thermomètre du changement climatique, mais on n'en est pas responsables. C'est toute la planète qui en est responsable ! »   Et si la foudre ministérielle est tombée sur la petite station des Pyrénées, elle aurait pu tout autant en toucher d'autres. Car la neige se fait de plus en plus rare, et cet hiver est particulièrement compliqué. Dans les Alpes, Montclar les Deux Vallées a aussi eu recours à des livraisons de neige par hélicoptère fin décembre pour sauver sa deuxième semaine des vacances de Noël. Une semaine avant Luchon, c'est Gérardmer, dans les Vosges, qui avait fait livrer de l'or blanc par camion.  Et la situation ne risque pas de s'arranger. « Les régions de montagne sont plus touchées que les plaines par le changement climatique : l'élévation de température y est en général plus forte qu'en moyenne sur la planète », prévient Météo-France. L'effet du réchauffement climatique devrait surtout se faire sentir à moyenne altitude, entre 1 200 et 2 000 mètres.  Lire aussi Réchauffement : la décennie écoulée a été la plus chaude jamais enregistrée   Les relevés de hauteur de neige effectués par Météo-France depuis 1960 à 1 325 mètres d'altitude au col de Porte, dans les Alpes – considérés comme une référence pour l'étude de l'enneigement à moyenne altitude en France – le montrent bien : si les hivers sans neige ont toujours existé, ils sont de plus en plus fréquents. Les hivers avec une grande quantité de neige sont, eux, de plus en plus rares. Et quand la neige est présente, c'est en moindre quantité, et pendant moins longtemps.   « On ne peut pas jouer contre la nature » À la ministre, qui a estimé dans 20 Minutes qu'« on ne peut pas jouer contre la nature », les stations, elles, opposent la pression économique à laquelle elles sont confrontées. À Montclar, le gestionnaire explique au Dauphiné libéré que l'intervention de l'hélicoptère a représenté un investissement de 8 000 euros, pour assurer l'ouverture sur une semaine de vacances qui devait rapporter 150 000 euros au seul exploitant, sans compter les retombées sur les commerçants. Le calcul a été vite fait.   En France, dans le top 3 mondial de fréquentation après les États-Unis et l'Autriche, le ski représente 18 000 emplois directs – permanents ou saisonniers –, 120 000 en tout, et 10 milliards d'euros de dépenses en station chaque hiver, selon Domaines skiables de France. Difficile de se défaire de la pratique des sports d'hiver quand elle est l'une des plus importantes sources de revenus en montagne. Face au changement climatique, les stations de ski ne semblent donc pas avoir encore pris la mesure du défi qui les attend.  Lire aussi France : la fréquentation touristique rebondit  Le changement climatique a pourtant déjà fait des victimes. À Saint-Honoré 1500, en Isère, les immeubles abandonnés en pleine construction témoignent de la chute brutale de cette petite station ouverte dans les années 1980 par une liaison avec le domaine skiable voisin de l'Alpe du Grand Serre. Déjà plombée par des problèmes financiers, la station, trop basse et exposée plein sud, manquait cruellement de neige. Les remontées mécaniques ont été fermées en 2003.   Depuis la fermeture des remontées mécaniques en 2003, la station Saint-Honoré 1500, dans les Alpes, est figée dans le temps.  © MAXPPP / PHOTOPQR/LE PROGRES Les stations à plus faible altitude sont les plus touchées par le changement climatique, et les plus faibles comme Saint-Honoré, qui n'ont pas les moyens d'investir pour se transformer, en sont les premières victimes. Depuis 1951, ce sont 169 stations qui ont mis la clé sous la porte, près de la moitié à cause du manque de neige, a calculé Pierre-Alexandre Métral, doctorant en géographie alpine à l'université de Grenoble. « Pendant trente ans, c'était des domaines skiables équipés de deux ou trois remontées mécaniques qui fermaient, explique-t-il à Slate. Mais depuis les années 2000, des stations de plus en plus grandes qui comptent parfois entre sept et dix remontées mécaniques ont mis la clé sous la porte. »  Course aux flocons Élisabeth Borne l'a reconnu : « Il faut un plan d'action pour accompagner les stations face au dérèglement climatique. » Mais existe-t-il seulement des solutions pour les sauver d'un phénomène global sur lequel elles n'ont aucune prise ? Bien souvent, c'est vers la neige de culture que les exploitants se sont tournés. Certes, cette neige a un coût (2,50 euros pour un mètre cube), consomme de l'électricité (1 à 3 kWh par mètre cube) et de l'eau (un mètre cube d'eau permet de produire le double de neige). Mais combinée à des dameuses intelligentes qui permettent de mieux répartir la neige, et à des pistes plus lisses qui nécessitent beaucoup moins d'enneigement pour être praticables, la neige de culture permet de limiter la casse et de garantir l'ouverture de la station.  La plupart des stations sont aujourd'hui équipées en canons à neige, et y consacrent 6 à 10 % du prix du forfait. Le prix à payer pour garantir l'activité. Dans une étude menée entre 2017 et 2018 sur 23 stations, le département de l'Isère estimait que 42 % de la surface de leurs domaines skiables seraient équipés pour la neige de culture d'ici à 2025, ce qui permettrait de « maintenir un niveau d'enneigement en 2050 similaire à celui d'aujourd'hui ».   Pour pallier au manque de neige, la plupart des stations se sont dotées de canons à neige, comme ici à Font-Romeu, dans les Pyrénées. Une solution de court-terme seulement.  © RAYMOND ROIG / AFP Mais cette solution miracle ne marchera pas sur le long terme. Pour faire de la neige, même artificielle, il faut qu'il fasse moins de zéro, ce qui, à l'horizon post-2050, n'est pas gagné. « Avec un taux de couverture par la neige de culture de 45 %, l'enneigement demeure comparable à la situation actuelle pour un réchauffement planétaire inférieur à deux degrés, mais au-delà de trois degrés, la neige de culture ne suffit plus à compenser la réduction de l'enneigement naturel », estime Météo-France, se basant sur une étude parue dans Scientific Reports.  Extension des domaines skiables Au lieu de s'acharner à fabriquer de la neige là où il fait trop chaud, certaines stations ont opté pour des extensions de leurs domaines vers le haut, à des altitudes qui souffrent moins du réchauffement et du manque de neige. Cet hiver, Valloire a inauguré un nouveau télésiège et deux pistes rouges dans un secteur encore non exploité, portant ainsi le point culminant du domaine skiable à 2 750 mètres. Pour préserver au maximum le relief de la montagne, et se préserver des critiques des militants écologiques, le terrassement des deux nouvelles pistes a été limité.  En Maurienne (Savoie), on a même ressorti des cartons un projet vieux de plus de 30 ans, pour l'inscrire à nouveau au schéma de cohérence territoriale (SCoT). « La Croix du Sud », une extension de près d'une centaine d'hectares pour les domaines skiables de Valmeinier et Valfréjus. Une nécessité pour survivre, explique à France Bleu Jean-Claude Raffin, vice-président du SCoT Pays de Maurienne : « Compte tenu du changement climatique, l'idée, c'est bien de pouvoir remonter les domaines skiables en altitude pour pérenniser encore nos stations pendant quelque temps. »  Lire aussi Cour des comptes : les stations de ski poussées à se réinventer  Une hérésie pour Annie Collombet, président de l'association Vivre et agir en Maurienne, qui regrette que l'« on continue dans les vieux schémas ». L'avis de la Mission régionale d'autorité environnement sur plusieurs projets de ce type en Auvergne-Rhône-Alpes n'est guère plus enthousiaste : « En l'état, certains de ces projets, tels que l'interconnexion de la Croix du Sud, l'extension des domaines skiables de Val Cenis ou d'Aussois, sont susceptibles de causer des dommages très significatifs, voire irréversibles, à des milieux écologiques d'une valeur exceptionnelle. »  Trouver un nouveau modèle Plutôt que de s'engager dans une bataille perdue d'avance contre le climat, d'autres ont préféré prendre les devants pour sécuriser leur activité sur le long terme en développant des modèles « quatre saisons ». L'objectif : casser le monopole du ski, qui attire encore la plus grande partie de la clientèle, en développant de nouvelles activités susceptibles de prendre sa succession le jour où la neige viendra à manquer. La ministre de l'Écologie a d'ailleurs poussé en ce sens jeudi 20 février, lors d'une réunion avec les représentants de stations après la polémique de Luchon. « Il faut accélérer cette transition », a-t-elle indiqué à l'Agence France Presse, promettant une « offre complète d'accompagnement des stations pour à la fois encourager leurs pratiques vertueuses en termes d'environnement et les aider à s'adapter ».  Un véritable défi car, pour le moment, la saison estivale ne représente que 5 % du chiffre d'affaires annuel des stations ouvertes à cette période. Plus de la moitié n'arrive même pas à couvrir leurs charges de fonctionnement pendant l'été. « Aujourd'hui, on n'a aucun produit pour remplacer la pente enneigée à dévaler, à ski, en snow ou autre », résume au Point le maire de Valloire. Pour opérer un véritable basculement, c'est tout le modèle économique des stations qu'il faut revoir.Plus les années passent, plus la neige monte, on le voit bien. À Chamrousse, la mairie a lancé le projet « Chamrousse 2030 », qui envisage de faire du village une « smart station d'altitude quatre saisons ». Au programme : une grande rénovation de Chamrousse 1650, avec construction de nouveaux bâtiments plus modernes que les barres que l'on trouve habituellement en station. L'objectif affiché est de faire venir plus d'habitants à l'année pour que les commerces puissent fonctionner sans dépendre du tourisme hivernal, développer le tourisme d'affaires et les séjours courts, et ouvrir une piste de luge d'été et un centre aquatique pour compléter l'offre hors neige (VTT, randonnées…) déjà existante. Encore faut-il avoir les moyens d'investir. Dans les Pyrénées-Orientales, la petite station municipale du Puigmal a fermé en 2013, ruinée par plusieurs saisons sans neige. « Plus les années passent, plus la neige remonte, on le voit bien », assure au Point Isidore Peyrato, premier adjoint d'Err, la commune sur laquelle était implantée la station. Elle a finalement rouvert fin 2019 sous une nouvelle forme : circuit de randonnée à ski, trail, pistes de VTT… C'est l'entreprise Rossignol, spécialiste du matériel et vêtements des sports d'hiver, qui a répondu à l'appel à projets de la mairie. « Ils ne gèrent pas la station, mais ils nous aident à mettre en place les parcours, notamment sur le plan technique, et assurent la promotion », moyennant une redevance de la commune, explique Isidore Peyrato. La station du Puigmal, dans les Pyrénées, ici en novembre 2017, a fermé en 2013 après plusieurs saisons sans neige. Elle a rouvert cet hiver sous une nouvelle forme. Les remontées mécaniques, elles, restent pour l'instant à l'arrêt. Les hivers étant devenus trop incertains, Err-Puigmal ne souhaite pas vraiment se relancer dans la gestion de l'infrastructure lourde d'une station de ski. Un loueur de matériel s'est à nouveau installé, et les élus espèrent bien voir rouvrir les anciens restaurants, aujourd'hui à l'abandon en bas des pistes. « La priorité pour l'instant, c'est de faire revivre l'économie. » À terme, les télésièges pourraient être redémarrés s'ils s'avèrent utiles pour remonter les VTT par exemple. Mais la mairie l'assure, à Puigmal, le ski alpin, c'est de l'histoire ancienne.
    """
    sentences = text.split(".")
    embedder = SentenceTransformer(model_file)
    corpus_embeddings = embedder.encode(sentences)

    queries = ['Un homme a peur de perdre son emploi.',
               "Le bilan carbone de la station est très bon en 2019.",
               "La station de Luchon-Superbagnères est très critiquée.",
               "Le réchauffement climatique se fait ressentir à moyenne altitude."]
    query_embeddings = embedder.encode(queries)

    # Find the closest 5 sentences of the corpus for each query sentence based on cosine similarity
    closest_n = 5
    for query, query_embedding in zip(queries, query_embeddings):
        distances = \
        scipy.spatial.distance.cdist([query_embedding], corpus_embeddings,
                                     "cosine")[0]

        results = zip(range(len(distances)), distances)
        results = sorted(results, key=lambda x: x[1])

        print("\n\n======================\n\n")
        print("Query:", query)
        print("\nTop 5 most similar sentences in corpus:")

        for idx, distance in results[0:closest_n]:
            print(sentences[idx].strip(), "(Score: %.4f)" % (1 - distance))